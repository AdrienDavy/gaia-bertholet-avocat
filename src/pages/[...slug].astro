---
import type { Block } from "@wp-block-tools/styles";
import BlockRenderer from "../components/BlockRenderer.astro";
import PostRenderer from "../components/PostRenderer.astro";
import CommonHead from "../components/CommonHead.astro";
import { wordpressQuery } from "../utils/wordpressQuery.ts";
import Footer from "../components/Footer.astro";

interface AstroParams {
  slug?: string;
}
const astroParams: AstroParams = Astro.params;
export async function getStaticPaths() {
  const data = await wordpressQuery({
    query: `
  query AllPages {
          pages(first: 10000) {
            nodes {
              uri
            }
          }
        }
      `,
  });
  return data.pages.nodes.map((page: any) => ({
    params: { slug: page.uri === "/" ? undefined : page.uri },
  }));
}
const data = await wordpressQuery({
  query: `
    query PageQuery($uri: String!) {
      nodeByUri(uri: $uri) {
        ... on Page {
          id
          blocks
          seo {
            metaDesc
            title
          }
        }
      }      
    }
    `,
  variables: {
    uri: astroParams.slug || "/",
  },
});
const blocks = (data.nodeByUri?.blocks || []) as Block[];
const seo = data.nodeByUri?.seo;

export const dataPosts = await wordpressQuery({
  query: `
  {
  posts(first: 2, where: {orderby: {field: DATE, order: DESC}}) {
    nodes {
      id
      title
      date
      excerpt
      content
      featuredImage {
        node {
          sourceUrl
          altText
        }
      }
      slug
    }
  }
}
      `,
});
---

<html lang="en">
  <CommonHead title={seo.title || ""} description={seo.metaDesc || ""} />
  <body>
    <BlockRenderer blocks={blocks} />
    <Footer blocks={blocks} />
  </body>
</html>
